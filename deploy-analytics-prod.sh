#!/bin/bash

echo "ğŸš€ DÃ©ploiement Analytics en Production CapRover"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "ğŸ“‹ Ã‰TAPES Ã€ SUIVRE:"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""

echo "1ï¸âƒ£  MIGRER LA BASE DE DONNÃ‰ES"
echo "   Se connecter au serveur PostgreSQL CapRover:"
echo ""
echo "   ssh root@votre-serveur"
echo "   docker exec -it \$(docker ps | grep postgres-monitoring | awk '{print \$1}') psql -U monitoring -d monitoring"
echo ""
echo "   Puis exÃ©cuter:"
echo "   CREATE TABLE IF NOT EXISTS \"AnalyticsEvent\" ("
echo "     \"id\" TEXT PRIMARY KEY,"
echo "     \"userId\" TEXT NOT NULL,"
echo "     \"eventType\" TEXT NOT NULL,"
echo "     \"metadata\" JSONB,"
echo "     \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP"
echo "   );"
echo ""
echo "   CREATE INDEX \"AnalyticsEvent_userId_idx\" ON \"AnalyticsEvent\"(\"userId\");"
echo "   CREATE INDEX \"AnalyticsEvent_eventType_idx\" ON \"AnalyticsEvent\"(\"eventType\");"
echo "   CREATE INDEX \"AnalyticsEvent_createdAt_idx\" ON \"AnalyticsEvent\"(\"createdAt\");"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""

echo "2ï¸âƒ£  AJOUTER VARIABLES (Optionnel - pour PostHog)"
echo "   Dans CapRover App Config (movers-test):"
echo ""
echo "   NEXT_PUBLIC_POSTHOG_KEY=phc_xxx"
echo "   NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com"
echo ""
echo "   (CrÃ©er compte gratuit sur https://app.posthog.com)"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""

echo "3ï¸âƒ£  DÃ‰PLOYER L'APP"
echo "   git push origin main  âœ… (dÃ©jÃ  fait)"
echo ""
echo "   Puis dans CapRover:"
echo "   - Deployment â†’ Deploy via ImageName"
echo "   - Ou attendre auto-deploy si configurÃ©"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""

echo "4ï¸âƒ£  TESTER LE DASHBOARD"
echo "   curl https://movers-test.gslv.cloud/api/analytics/dashboard | jq"
echo ""
echo "   Ou dans le navigateur:"
echo "   https://movers-test.gslv.cloud/api/analytics/dashboard"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""

echo "âœ… Une fois dÃ©ployÃ©, les Ã©vÃ©nements seront trackÃ©s automatiquement !"
echo ""

